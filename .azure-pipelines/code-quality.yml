trigger:
- master

pool:
  vmImage: 'ubuntu-16.04'

container: ninhu/r-sdk-build:latest

steps:
  - task: Bash@3
    inputs:
      targetType: 'inline'
      script: |
        Rscript './.azure-pipelines/scripts/validate_copyright_header.R' 'R'
    displayName: 'Validate copyright header'

  - task: Bash@3
    inputs:
      targetType: 'inline'
      script: |
        Rscript './.azure-pipelines/scripts/check_code_style.R' 'R'
    displayName: 'Check code style'

  - task: Bash@3
    inputs:
      targetType: 'inline'
      script: |
        R -e 'library("rcmdcheck");
        check_results <- rcmdcheck(".", args = c("--no-manual", "--no-tests"));
        stopifnot(length(check_results$errors) == 0);
        stopifnot(length(check_results$warnings) == 0);
        stopifnot(length(check_results$notes) == 0)'
    displayName: 'Check package build'
