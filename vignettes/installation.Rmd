---
title: "Installing AzureML SDK for R"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Installing AzureML SDK for R}
  %\VignetteEngine{knitr::rmarkdown}
  \use_package{UTF-8}
---

## 1. Install Anaconda

If you do not have Anaconda already installed on your machine, you will first need to [install](https://www.anaconda.com/distribution/) it. Choose the 64-bit binary for Python 3.5 or later.

## 2. Install `azureml` R package with `remotes`
As the `azureml` package is not available on CRAN, you will need `remotes` to install from the GitHub repo.
``` {r Install Remotes, eval=FALSE}
install.packages('remotes')
``` 
Then, you can use the `install_github` function to install the package.

``` {r Install Azureml, eval=FALSE}
remotes::install_github('https://github.com/Azure/azureml-sdk-for-r')
```

## 3. Install AzureML Python SDK
Lastly, use the `azureml` R library to install the compiled code. By default, `azureml::install_azureml` will install the [latest version of the AzureML Python SDK](https://pypi.org/project/azureml-sdk/) in a conda environment called `r-azureml`.

If you would like to override the default version, environment name, or python version, you can pass in those arguments: 
``` {r Install AzureML Python SDK, eval=FALSE}
azureml::install_azureml(version = NULL, 
                         envname = "<your conda environment name>",
                         conda_python_version = "<desired python version>")
```

## 4. Test installation
You can confirm your installation worked by loading the library and successfully retrieving a run.
``` {r Test installation, echo=TRUE}
library(azuremlsdk)
get_current_run()
```

## Troubleshooting
-   In step 3 of the installation, if you get ssl errors on windows, it is due to an
outdated openssl binary. Install the latest openssl binaries from
[here](https://wiki.openssl.org/index.php/Binaries).

- If installation fails due to this error:

  ```R
  Error in strptime(xx, f, tz = tz) : 
    (converted from warning) unable to identify current timezone 'C':
  please set environment variable 'TZ'
  In R CMD INSTALL
  Error in i.p(...) : 
    (converted from warning) installation of package ‘C:/.../azureml_0.4.0.tar.gz’ had non-zero exit
    status
  ```
  
  You will need to set your time zone environment variable to GMT and restart the installation process.
  
  ```R
  Sys.setenv(TZ='GMT')
  ```

- If the following permission error occurs while installing in RStudio,
  change your RStudio session to administrator mode, and re-run the installation command.

  ```R
  Downloading GitHub repo Azure/azureml-sdk-for-r@master
  Skipping 2 packages ahead of CRAN: reticulate, rlang
  Running `R CMD build`...
  
  Error: (converted from warning) invalid package
  'C:/.../file2b441bf23631'
  In R CMD INSTALL
  Error in i.p(...) : 
    (converted from warning) installation of package
    ‘C:/.../file2b441bf23631’ had non-zero exit status
  In addition: Warning messages:
  1: In file(con, "r") :
    cannot open file 'C:...\file2b44144a540f': Permission denied
  2: In file(con, "r") :
    cannot open file 'C:...\file2b4463c21577': Permission denied
  ```
  