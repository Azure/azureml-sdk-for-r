<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploy a web service to Azure Kubernetes Service • azuremlsdk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Deploy a web service to Azure Kubernetes Service">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">azuremlsdk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/installation.html">Install the Azure ML SDK for R</a>
    </li>
    <li>
      <a href="../../articles/configuration.html">Set up an Azure ML workspace</a>
    </li>
    <li>
      <a href="../../articles/train-and-deploy-to-aci/train-and-deploy-to-aci.html">Train and deploy your first model with Azure ML</a>
    </li>
    <li>
      <a href="../../articles/train-with-tensorflow/train-with-tensorflow.html">Train a TensorFlow model</a>
    </li>
    <li>
      <a href="../../articles/hyperparameter-tune-with-keras/hyperparameter-tune-with-keras.html">Hyperparameter tune a Keras model</a>
    </li>
    <li>
      <a href="../../articles/deploy-to-aks/deploy-to-aks.html">Deploy a web service to Azure Kubernetes Service</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/azure/azureml-sdk-for-r">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Deploy a web service to Azure Kubernetes Service</h1>
            
            <h4 class="date">2019-11-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/azure/azureml-sdk-for-r/blob/master/vignettes/deploy-to-aks/deploy-to-aks.Rmd"><code>vignettes/deploy-to-aks/deploy-to-aks.Rmd</code></a></small>
      <div class="hidden name"><code>deploy-to-aks.Rmd</code></div>

    </div>

    
    
<p>This tutorial demonstrates how to deploy a model as a web service on <a href="https://azure.microsoft.com/en-us/services/kubernetes-service/">Azure Kubernetes Service</a> (AKS). AKS is good for high-scale production deployments; use it if you need one or more of the following capabilities:</p>
<ul>
<li>Fast response time</li>
<li>Autoscaling of the deployed service</li>
<li>Hardware acceleration options such as GPU</li>
</ul>
<p>You will learn to:</p>
<ul>
<li>Set up your testing environment</li>
<li>Register a model</li>
<li>Provision an AKS cluster</li>
<li>Deploy the model to AKS</li>
<li>Test the deployed service</li>
</ul>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>If you don’t have access to an Azure ML workspace, follow the <a href="https://azure.github.io/azureml-sdk-for-r/articles/configuration.html">setup tutorial</a> to configure and create a workspace.</p>
</div>
<div id="set-up-your-testing-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-your-testing-environment" class="anchor"></a>Set up your testing environment</h2>
<p>Start by setting up your environment. This includes importing the <strong>azuremlsdk</strong> package and connecting to your workspace.</p>
<div id="import-package" class="section level3">
<h3 class="hasAnchor">
<a href="#import-package" class="anchor"></a>Import package</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(azuremlsdk)</a></code></pre></div>
</div>
<div id="load-your-workspace" class="section level3">
<h3 class="hasAnchor">
<a href="#load-your-workspace" class="anchor"></a>Load your workspace</h3>
<p>Instantiate a workspace object from your existing workspace. The following code will load the workspace details from a <strong>config.json</strong> file if you previously wrote one out with <code><a href="https://rdrr.io/pkg/azuremlsdk/man/write_workspace_config.html">write_workspace_config()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ws &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/load_workspace_from_config.html">load_workspace_from_config</a></span>()</a></code></pre></div>
<p>Or, you can retrieve a workspace by directly specifying your workspace details:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">ws &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/get_workspace.html">get_workspace</a></span>(<span class="st">"&lt;your workspace name&gt;"</span>, <span class="st">"&lt;your subscription ID&gt;"</span>, <span class="st">"&lt;your resource group&gt;"</span>)</a></code></pre></div>
</div>
</div>
<div id="register-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#register-the-model" class="anchor"></a>Register the model</h2>
<p>In this tutorial we will deploy a model that was trained in one of the <a href="https://github.com/Azure/azureml-sdk-for-r/blob/master/samples/training/train-on-amlcompute/train-on-amlcompute.R">samples</a>. The model was trained with the Iris dataset and can be used to determine if a flower is one of three Iris flower species (setosa, versicolor, virginica). We have provided the model file (<code>model.rds</code>) for the tutorial; it is located in the same directory as this vignette.</p>
<p>First, register the model to your workspace with <a href="https://azure.github.io/azureml-sdk-for-r/reference/register_model.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/register_model.html">register_model()</a></code></a>. A registered model can be any collection of files, but in this case the R model file is sufficient. Azure ML will use the registered model for deployment.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/register_model.html">register_model</a></span>(ws, </a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                        <span class="dt">model_path =</span> <span class="st">"model.rds"</span>, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                        <span class="dt">model_name =</span> <span class="st">"iris_model"</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                        <span class="dt">description =</span> <span class="st">"Predict an Iris flower type"</span>)</a></code></pre></div>
</div>
<div id="provision-an-aks-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#provision-an-aks-cluster" class="anchor"></a>Provision an AKS cluster</h2>
<p>When deploying a web service to AKS, you deploy to an AKS cluster that is connected to your workspace. There are two ways to connect an AKS cluster to your workspace:</p>
<ul>
<li>Create the AKS cluster. The process automatically connects the cluster to the workspace.</li>
<li>Attach an existing AKS cluster to your workspace. You can attach a cluster with the <a href="https://azure.github.io/azureml-sdk-for-r/reference/attach_aks_compute.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/attach_aks_compute.html">attach_aks_compute()</a></code></a> method.</li>
</ul>
<p>Creating or attaching an AKS cluster is a one-time process for your workspace. You can reuse this cluster for multiple deployments. If you delete the cluster or the resource group that contains it, you must create a new cluster the next time you need to deploy.</p>
<p>In this tutorial, we will go with the first method of provisioning a new cluster. See the <a href="https://azure.github.io/azureml-sdk-for-r/reference/create_aks_compute.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/create_aks_compute.html">create_aks_compute()</a></code></a> reference for the full set of configurable parameters. If you pick custom values for the <code>agent_count</code> and <code>vm_size</code> parameters, you need to make sure <code>agent_count</code> multiplied by <code>vm_size</code> is greater than or equal to <code>12</code> virtual CPUs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">aks_target &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/create_aks_compute.html">create_aks_compute</a></span>(ws, <span class="dt">cluster_name =</span> <span class="st">'myakscluster'</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/wait_for_provisioning_completion.html">wait_for_provisioning_completion</a></span>(aks_target, <span class="dt">show_output =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The Azure ML SDK does not provide support for scaling an AKS cluster. To scale the nodes in the cluster, use the UI for your AKS cluster in the Azure portal. You can only change the node count, not the VM size of the cluster.</p>
</div>
<div id="deploy-as-a-web-service" class="section level2">
<h2 class="hasAnchor">
<a href="#deploy-as-a-web-service" class="anchor"></a>Deploy as a web service</h2>
<div id="define-the-inference-dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#define-the-inference-dependencies" class="anchor"></a>Define the inference dependencies</h3>
<p>To deploy a model, you need an <strong>inference configuration</strong>, which describes the environment needed to host the model and web service. To create an inference config, you will first need a scoring script and an Azure ML environment.</p>
<p>The scoring script (<code>entry_script</code>) is an R script that will take as input variable values (in JSON format) and output a prediction from your model. For this tutorial, use the provided scoring file <code>score.R</code>. The scoring script must contain an <code>init()</code> method that loads your model and returns a function that uses the model to make a prediction based on the input data. See the <a href="https://azure.github.io/azureml-sdk-for-r/reference/inference_config.html#details">documentation</a> for more details.</p>
<p>Next, define an Azure ML <strong>environment</strong> for your script’s package dependencies. With an environment, you specify R packages (from CRAN or elsewhere) that are needed for your script to run. You can also provide the values of environment variables that your script can reference to modify its behavior.</p>
<p>By default Azure ML will build a default Docker image that includes R, the Azure ML SDK, and additional required dependencies for deployment. See the documentation here for the full list of dependencies that will be installed in the default container. You can also specify additional packages to be installed at runtime, or even a custom Docker image to be used instead of the base image that will be built, using the other available parameters to <a href="https://azure.github.io/azureml-sdk-for-r/reference/r_environment.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/r_environment.html">r_environment()</a></code></a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">r_env &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/r_environment.html">r_environment</a></span>(<span class="dt">name =</span> <span class="st">"deploy_env"</span>)</a></code></pre></div>
<p>Now you have everything you need to create an inference config for encapsulating your scoring script and environment dependencies.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">inference_config &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/inference_config.html">inference_config</a></span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">entry_script =</span> <span class="st">"score.R"</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">source_directory =</span> <span class="st">"."</span>,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="dt">environment =</span> r_env)</a></code></pre></div>
</div>
<div id="deploy-to-aks" class="section level3">
<h3 class="hasAnchor">
<a href="#deploy-to-aks" class="anchor"></a>Deploy to AKS</h3>
<p>Now, define the deployment configuration that describes the compute resources needed, for example, the number of cores and memory. See the <a href="https://azure.github.io/azureml-sdk-for-r/reference/aks_webservice_deployment_config.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/aks_webservice_deployment_config.html">aks_webservice_deployment_config()</a></code></a> for the full set of configurable parameters.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">aks_config &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/aks_webservice_deployment_config.html">aks_webservice_deployment_config</a></span>(<span class="dt">cpu_cores =</span> <span class="dv">1</span>, <span class="dt">memory_gb =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Now, deploy your model as a web service to the AKS cluster you created earlier.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">aks_service &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/deploy_model.html">deploy_model</a></span>(ws, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                            <span class="st">'my-new-aksservice'</span>, </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                            <span class="dt">models =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(model), </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                            <span class="dt">inference_config =</span> inference_config, </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                            <span class="dt">deployment_config =</span> aks_config,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                            <span class="dt">deployment_target =</span> aks_target)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/wait_for_deployment.html">wait_for_deployment</a></span>(aks_service, <span class="dt">show_output =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>To inspect the logs from the deployment:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/get_webservice_logs.html">get_webservice_logs</a></span>(aks_service)</a></code></pre></div>
<p>If you encounter any issue in deploying the web service, please visit the <a href="https://docs.microsoft.com/en-us/azure/machine-learning/service/how-to-troubleshoot-deployment">troubleshooting guide</a>.</p>
</div>
</div>
<div id="test-the-deployed-service" class="section level2">
<h2 class="hasAnchor">
<a href="#test-the-deployed-service" class="anchor"></a>Test the deployed service</h2>
<p>Now that your model is deployed as a service, you can test the service from R using <a href="https://azure.github.io/azureml-sdk-for-r/reference/invoke_webservice.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/invoke_webservice.html">invoke_webservice()</a></code></a>. Provide a new set of data to predict from, convert it to JSON, and send it to the service.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(jsonlite)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"># versicolor</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">plant &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">Sepal.Length =</span> <span class="fl">6.4</span>,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">                    <span class="dt">Sepal.Width =</span> <span class="fl">2.8</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">                    <span class="dt">Petal.Length =</span> <span class="fl">4.6</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                    <span class="dt">Petal.Width =</span> <span class="fl">1.8</span>)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co"># setosa</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co"># plant &lt;- data.frame(Sepal.Length = 5.1,</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#                    Sepal.Width = 3.5,</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#                    Petal.Length = 1.4,</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#                    Petal.Width = 0.2)</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co"># virginica</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co"># plant &lt;- data.frame(Sepal.Length = 6.7,</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#                    Sepal.Width = 3.3,</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#                    Petal.Length = 5.2,</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#                    Petal.Width = 2.3)</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"></a>
<a class="sourceLine" id="cb11-20" data-line-number="20">predicted_val &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/invoke_webservice.html">invoke_webservice</a></span>(aks_service, <span class="kw"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span>(plant))</a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(predicted_val)</a></code></pre></div>
<p>You can also get the web service’s HTTP endpoint, which accepts REST client calls. You can share this endpoint with anyone who wants to test the web service or integrate it into an application.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">aks_service<span class="op">$</span>scoring_uri</a></code></pre></div>
</div>
<div id="web-service-authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#web-service-authentication" class="anchor"></a>Web service authentication</h2>
<p>When deploying to AKS, key-based authentication is enabled by default. You can also enable token-based authentication. Token-based authentication requires clients to use an Azure Active Directory account to request an authentication token, which is used to make requests to the deployed service.</p>
<p>To disable key-based auth, set the <code>auth_enabled = FALSE</code> parameter when creating the deployment configuration with <a href="https://azure.github.io/azureml-sdk-for-r/reference/aks_webservice_deployment_config.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/aks_webservice_deployment_config.html">aks_webservice_deployment_config()</a></code></a>. To enable token-based auth, set <code>token_auth_enabled = TRUE</code> when creating the deployment config.</p>
<div id="key-based-authentication" class="section level3">
<h3 class="hasAnchor">
<a href="#key-based-authentication" class="anchor"></a>Key-based authentication</h3>
<p>If key authentication is enabled, you can use the <a href="https://azure.github.io/azureml-sdk-for-r/reference/get_webservice_keys.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/get_webservice_keys.html">get_webservice_keys()</a></code></a> method to retrieve a primary and secondary authentication key. To generate a new key, use <a href="https://azure.github.io/azureml-sdk-for-r/reference/generate_new_webservice_key.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/generate_new_webservice_key.html">generate_new_webservice_key()</a></code></a>.</p>
</div>
<div id="token-based-authentication" class="section level3">
<h3 class="hasAnchor">
<a href="#token-based-authentication" class="anchor"></a>Token-based authentication</h3>
<p>If token authentication is enabled, you can use the <a href="https://azure.github.io/azureml-sdk-for-r/reference/get_webservice_token.html"><code><a href="https://rdrr.io/pkg/azuremlsdk/man/get_webservice_token.html">get_webservice_token()</a></code></a> method to retrieve a JWT token and that token’s expiration time. Make sure to request a new token after the token’s expiration time.</p>
</div>
</div>
<div id="clean-up-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-up-resources" class="anchor"></a>Clean up resources</h2>
<p>Delete the resources once you no longer need them. Do not delete any resource you plan on still using.</p>
<p>Delete the web service:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/delete_webservice.html">delete_webservice</a></span>(aks_service)</a></code></pre></div>
<p>Delete the registered model:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/delete_model.html">delete_model</a></span>(model)</a></code></pre></div>
<p>Delete the AKS cluster:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/azuremlsdk/man/delete_compute.html">delete_compute</a></span>(aks_target)</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#set-up-your-testing-environment">Set up your testing environment</a></li>
      <li><a href="#register-the-model">Register the model</a></li>
      <li><a href="#provision-an-aks-cluster">Provision an AKS cluster</a></li>
      <li><a href="#deploy-as-a-web-service">Deploy as a web service</a></li>
      <li><a href="#test-the-deployed-service">Test the deployed service</a></li>
      <li><a href="#web-service-authentication">Web service authentication</a></li>
      <li><a href="#clean-up-resources">Clean up resources</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Heemanshu Suri, Billy Hu, Diondra Peck, Minna Xiao, Microsoft.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
